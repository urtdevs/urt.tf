#!/usr/bin/env bash

set -e

apt-get update
apt-get upgrade -y

apt-get install wget unzip -y

mkdir -p /opt/urt/

wget -O /opt/urt/server.tar.gz 'http://mirror.urtstats.net/urbanterror/UrbanTerror42_full023.zip'

mkdir -p /tmp/urtserver/
unzip /opt/urt/server.tar.gz -d /tmp/urtserver/

mv /tmp/urtserver/UrbanTerror42 /opt/urt/urtserver/
rm -rf /tmp/urtserver

useradd -M -d /opt/urt/ -s /bin/false -U urtserver
chown -R urtserver:urtserver /opt/urt

cat >/etc/init/urtserver.conf <<EOF
description "urban terror server"
author "Jon Chen"

setuid urtserver
setgid urtserver

start on filesystem and net-device-up IFACE=eth0
respawn

exec /opt/urt/urtserver/Quake3-UrT-Ded.x86_64
EOF

start urtserver
